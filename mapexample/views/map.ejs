<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<title>Map Example</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.css' rel='stylesheet' />
	<style>
		body { margin:0; padding:0; }
		#map { position:absolute; top:0; bottom:0; width:100%; }
	</style>
</head>
<body>
 
<div id='map'></div>
<script>

function getColor(rating) {
	if (rating <= 3) {
		return "#f44542"
	} else if (rating <= 6) {
		return "#f4eb41"
	} else if (rating <= 9) {
		return "#67f441"
	} else {
		return "#057f17"
	}
}


mapboxgl.accessToken = 'pk.eyJ1IjoianphdHVyZW5za3kiLCJhIjoiY2owaW42cDJ1MDEwczMydGp0cXNidmtmNSJ9.r-pjoq0aLm2F8VtA3bz8Fg';
var map = new mapboxgl.Map({
	container: 'map', // container id
	style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
	center: [-95, 40], // starting position [lng, lat]
	zoom: 4 // starting zoom
});

var responses = <%- JSON.stringify(responses) %>;

for (var i = 0; i < 200; i++) {

	var popupOffsets = {
	 'top': [0, 0],
	 'top-left': [0,0],
	 'top-right': [0,0],
	 'bottom': [0, -markerHeight],
	 'bottom-left': [linearOffset, (markerHeight - markerRadius + linearOffset) * -1],
	 'bottom-right': [-linearOffset, (markerHeight - markerRadius + linearOffset) * -1],
	 'left': [markerRadius, (markerHeight - markerRadius) * -1],
	 'right': [-markerRadius, (markerHeight - markerRadius) * -1]
	 };
	var popup = new mapboxgl.Popup({offset: popupOffsets, className: 'my-class'})
	  .setHTML("<h3>Overall Satisfaction: "+responses[i].overall_satisfaction+"</h3>"+responses[i].comment)
	  .setMaxWidth("300px")

	var markerHeight = 50, markerRadius = 10, linearOffset = 25;
	var marker = new mapboxgl.Marker({color: getColor(responses[i].overall_satisfaction)})
	  .setLngLat([responses[i].longitude, responses[i].latitude])
	  .addTo(map)
	  .setPopup(popup);
}

</script>
 
</body>
</html>